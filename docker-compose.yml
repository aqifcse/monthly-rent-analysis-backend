services:
  api:
    # Build the FastAPI app using the Dockerfile in the current directory.
    build: .
    container_name: api
    ports:
      - "8000:8000"
    environment:
      # Define the database connection URL.
      # Here, 'postgres' is the service name of our PostgreSQL container.
      # Change 'postgres' (username), 'postgres' (password), and 'mydatabase' as needed.
      DATABASE_URL: "postgresql://sampleuser:samplepass@db:5432/sample_db"
    depends_on:
      - db

  db:
    image: postgres:latest
    container_name: db
    restart: always  # Automatically restart the container if it crashes
    environment:
      # Set up default PostgreSQL credentials and database name.
      POSTGRES_USER: sampleuser
      POSTGRES_PASSWORD: samplepass
      POSTGRES_DB: sample_db
    ports:
      - "5432:5432"  # Map container port 5432 to host port 5432
    volumes:
      # Persist PostgreSQL data on the host using a named volume.
      - postgres_data:/var/lib/postgresql/data/v1

# Define named volumes for data persistence.
volumes:
  postgres_data: